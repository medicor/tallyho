<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/firebase-element/firebase-collection.html">
<link rel="import" href="../bower_components/firebase-element/firebase-auth.html">
<link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">

<dom-module id="x-app">
	<style>
		:host {
			display: block;
		}
		
		.nav {
			border-right: 1px solid #ccc;
		}
		
		.list-panel {
			background-color: #fafafa;
		}
		
		.list-panel {
			--paper-header-panel-standard-container: {
				border-right: 1px solid #ccc;
			}
			;
		}
		
		paper-toolbar {
			background-color: #42A5F5;
		}
		
		.list {
			padding: 0;
		}
		
		.list paper-item {
			height: 80px;
			border-bottom: 1px solid #dedede;
			background-color: #fafafa;
		}
		
		.main-drawer-panel:not([narrow]) [list-toggle] {
			display: none;
		}
		
		.content {
			height: 3000px;
		}
	</style>
	<template>
		<firebase-auth id="authenticator" user="{{user}}" location="https://medicor.firebaseio.com" ref="{{refauth}}" provider="github"></firebase-auth>
		<paper-dialog modal opened="{{!user}}" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
			<h2>Oh hai! Please sign in</h2>
			<div>
				<div class="google-sign-in" tabindex="0" on-tap="signIn">
					<span class="google-sign-in-icon"></span>
					<span class="google-sign-in-label">Google</span>
				</div>
			</div>
		</paper-dialog>
		<paper-drawer-panel id="navDrawerPanel" responsive-width="1280px">
			<div class="nav" drawer>
				<!-- Nav Content -->
			</div>
			<paper-drawer-panel id="mainDrawerPanel" class="main-drawer-panel" main responsive-width="600px" drawer-width="[[_computeListWidth(_isMobile)]]" drawer-toggle-attribute="list-toggle" narrow="{{_isMobile}}">
				<paper-header-panel class="list-panel" drawer>
					<!-- List Toolbar -->
					<paper-toolbar>
						<paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
						<button on-tap="login">Login</button>
						<button on-tap="logout">Logout</button>
					</paper-toolbar>
					<!-- List -->
					<paper-menu class="list" on-iron-activate="_listTap">
						<firebase-collection location="https://medicor.firebaseio.com/companies/customers" data="{{customers}}"></firebase-collection>
						<template is="dom-repeat" items="[[customers]]" as="customer">
							<paper-item>
								[[customer.__firebaseKey__]]
								<br> [[customer.contactName]]
							</paper-item>
						</template>
					</paper-menu>
				</paper-header-panel>
				<paper-header-panel class="content-panel" main>
					<!-- Main Toolbar -->
					<paper-toolbar>
						<paper-icon-button icon="arrow-back" list-toggle></paper-icon-button>
					</paper-toolbar>
					<!-- Main Content -->
					<div class="content">
						<h1>TODO:s</h1>
						<ul>
							<li>Add authorization through firebase-auth.</li>
							<li>Use http://cheonhyangzhang.github.io/paper-typeahead-input/components/paper-typeahead-input/</li>
						</ul>
						<p>Status: {{computeLoginStatus(user)}}</p>
						<pre>{{user.uid}}</pre>
					</div>
				</paper-header-panel>
			</paper-drawer-panel>
		</paper-drawer-panel>
	</template>
	<script>
		Polymer({
			is: 'x-app',

			properties: {
				user: {
					notify: true
				}
			},

			login: function() {
				this.$.authenticator.login();
			},
			logout: function() {
				this.$.authenticator.logout();
			},
			onLogin: function(e) {
				console.log(e);
			},
			computeLoginStatus: function(user) {
				console.log(user);
				if (user) {
					return 'Logged in';
				}
				return 'Not authenticated';
			},
			_computeListWidth: function(isMobile) {
				// when in mobile screen size, make the list be 100% width to cover the whole screen
				return isMobile ? '100%' : '33%';
			},
			_listTap: function() {
				this.$.mainDrawerPanel.closeDrawer();
			}
		});
	</script>
</dom-module>